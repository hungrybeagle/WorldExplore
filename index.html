<doctype html5>
<html>
	<head>
		<style>
			#map {
				position: absolute;
				left:10px;
				top:10px;
				border: 1px solid #aaa;
				width: 210px;
				height: 212px;
				margin: auto;
			}
			#map td {
				width: 30px;
				height: 30px;
				padding: 0;
			}
			section#control {
				position: absolute;
				left: 220;
				top:10px;
				border: 1px solid black;
				text-align:center;
			}
		</style>
		<script
		  src="https://code.jquery.com/jquery-3.4.1.js"
		  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
		  crossorigin="anonymous"></script>		
		<script>
			var game = {
				player : {
					x: 10,
					y: 10
				},
				map : {
					"10,10" : {
						terrain : "city",
						sprawling : false
					},
					"10,9" : {
						terrain : "plains",
						sprawling : true
					},
					"10,11" : {
						terrain : "plains",
						sprawling : true
					},
					"9,9" : {
						terrain : "plains",
						sprawling : true
					},
					"9,10" : {
						terrain : "plains",
						sprawling : true
					},
					"9,11" : {
						terrain : "plains",
						sprawling : true
					},
					"11,9" : {
						terrain : "plains",
						sprawling : true
					},
					"11,10" : {
						terrain : "plains",
						sprawling : true
					},
					"11,11" : {
						terrain : "plains",
						sprawling : true
					},
					
					
				},
				createMap: function() {
					let tbl = document.createElement("table");
					tbl.setAttribute("id","mapTable");
					tbl.setAttribute("cellspacing","0");
					tbl.setAttribute("cellpadding","0");
					
					let tbldata = "";
					for (let i = 0; i < 7; i++) {
						tbldata += "<tr>";
						for (let j = 0; j < 7; j++) {
							tbldata += "<td></td>";
						}
						tbldata += "</tr>"
					}
					tbl.innerHTML = tbldata;
					$("section#map").append(tbl);
				},
				genTile : function(see,me) {
					console.log("gen: " + see[0] + " + " + see[1])
					console.log(me);

					
					if (game.map[me[0]+","+me[1]].sprawling) {
						console.log('sprawling');
						return 'mountain';
					}
					else {
						console.log('not sprawling');
						return 'forest';
					}
				},
				gettile : function(row,col) {
					var x = game.player.x - 3 + col;
					var y = game.player.y + 3 - row;
					var center = [game.player.x,game.player.y]
					var see = [x,y];
					//console.log(x+","+y);
					let currTile = x + "," + y;
					if (game.map[currTile])
						return game.map[currTile].terrain;
					else
						if (Math.abs(row-3) <2 && (Math.abs(col-3) < 2)) {
							let see = [x,y];
							return game.genTile(see,center);
							}
						return "unknown";
				},
				redrawMap: function() {
					var tiles = $("section#map").find("td");
					for (var i = 0; i < 7; i++)
						for (var j = 0; j < 7; j++) {
							var tile = game.gettile(i,j);
							//console.log("map."+tile+".png")
							tiles[7*i+j].style.backgroundImage="url(map."+tile+".png)";
							//tiles[5*i+j].innerHTML="<img src='map."+tile+".png'>";
						}
					tiles[24].innerHTML="<image src='sprite.png'>";
				},
				createEventListeners: function() {
					$("button.nav").on("click", function(evt) {
						let direction = evt.target.innerHTML;
						switch (direction) {
							case "North" : {
								game.player.y++;
							} break;
							case "West" : {
								game.player.x--;
							} break;
							case "East" : {
								game.player.x++
							} break;
							case "South" : {
								game.player.y--
							} break;
						}
						console.log(game.player.x + " " + game.player.y);
						game.redrawMap();
					})
				}
			}
			$(document).ready( function() {
				game.createMap();
				game.redrawMap();
				game.createEventListeners();
			}
			)
		</script>
	</head>
	<body>
		<section id="map">
		</section>
		<section id="control">
			<button type='button' class="nav">North</button><br>
			<button type='button' class="nav">West</button>
			<button type='button' class="nav">East</button><br>
			<button type='button' class="nav">South</button><br>
			
			
		</section>
	</body>
	
</html>
